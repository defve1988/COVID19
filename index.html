<!DOCTYPE html>
<html>
<head>
  <title>COVID-19 Tracker</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/d3-simple-slider"></script>

  <script src="./src/dispMap.js"></script>
  <script src="./src/setlegend.js"></script>
  <link rel="stylesheet" type="text/css" href="./src/style.css">
</head>

<header>
Coronavirus Disease 2019 (COVID-19) Tracker
</header>

<body>
  <div id="slider"><!-- <span id="legend"></span> --></div>
  <hr>
    <div id="global_num">
      <p style="font-weight: 800;font-size:26px">Global Situation</p>
      <p id="date"></p>
      <p style="">Total Infected Countries</p>
      <p id="tot_country"></p>
      <p style="">Total Confirmed Cases</p>
      <p id="tot_confirm"></p>
      <p style="">Total Recovered Casese</p>
      <p id="tot_recover"></p>
      <p style="">Total Deaths</p>
      <p id="tot_death"></p>
    </div>
  <div id="parent">
    <div id="check_box"></div>
    <div id="map"></div>
  </div>

  <div id="barchart" style="overflow:auto;"></div>
  


  <script>
    Plotly.d3.csv(confirmed, function(err, rows_confirm){
      Plotly.d3.csv(recovered, function(err, row_recover){
        Plotly.d3.csv(deaths, function(err, row_death){

          var DAYS = Object.keys(rows_confirm[0]).length-4
          var dataNewYorkTimes = d3.range(1, 41).map(d => ({
              year: d,
              value: 10000 * Math.exp(-(d - 1) / 40),
            }));

          var dataTime = d3.range(0, DAYS).map(function(d){return new Date(2020, 0, 22+d);});
          mapbox_data.ini_data(rows_confirm,d3.min(dataTime),'confirm')
          mapbox_data.ini_data(row_recover,d3.min(dataTime),'recover')
          mapbox_data.ini_data(row_death,d3.min(dataTime),'death')
          mapbox_data.adjust_size()

          Plotly.newPlot(map, mapbox_data.data, map_layout, config);
          Plotly.addTraces(map, mapbox_data.confirm);
          Plotly.addTraces(map, mapbox_data.recover);
          Plotly.addTraces(map, mapbox_data.death);


  //         var line_data = [{
  //   type: 'scattermapbox',
  //   lat: [ 40.7127, 45, 51.5072 ],
  //   lon: [ -74.0059, -37, 0.1275 ],
  //   mode: 'lines',
  //   line:{
  //       width: 2,
  //       color: 'blue'
  //   }
  // }];

  //         Plotly.addTraces(map, line_data);

          mapbox_data.ini_bar()
          Plotly.newPlot(barchart, mapbox_data.bar_data, bar_layout);

          mapbox_data.set_nums(d3.min(dataTime))
          // console.log(mapbox_data)

          var slider = d3
            .sliderBottom()
            .min(d3.min(dataTime))
            .max(d3.max(dataTime))
            .step(1000 * 60 * 60 * 24)
            .width(600)
            .ticks(10)
            .fill(["red"])
            .displayValue(true)
            .on('onchange', val => {
              mapbox_data.update_data(rows_confirm,val,'confirm')
              mapbox_data.update_data(row_recover,val,'recover')
              mapbox_data.update_data(row_death,val,'death')
              mapbox_data.adjust_size()
              Plotly.redraw(map)
              mapbox_data.set_nums(val)

              mapbox_data.ini_bar()
              Plotly.newPlot(barchart, mapbox_data.bar_data, bar_layout);
            });
         
          d3.select('#slider')
            .append('svg')
            .attr('width', 800)
            .attr('height', 100)
            .append('g')
            .attr('transform', 'translate(30,30)')
            .call(slider);

          d3.select("#check_box")
            .append("svg")
            .attr("height",20)
            .attr("width",20)
            .append("circle")
            .attr("cx",10)
            .attr("cy",12)
            .attr("r",8)
            .style("fill","#ff3300")
            .style("opacity", 0.5)
          d3.select("#check_box")
            .append("input")
            .attr("type", "checkbox")
            .attr("checked", true)
            .attr("id","box1")
            .attr("onClick", "boxclick(this,mapbox_data)")
          d3.select("#check_box")
            .append('label')
            .text("Confirmed Cases")

          d3.select("#check_box")
            .append("svg")
            .attr("height",20)
            .attr("width",20)
            .append("circle")
            .attr("cx",10)
            .attr("cy",12)
            .attr("r",8)
            .style("fill","#15F228")
            .style("opacity", 0.7)
          d3.select("#check_box")
            .append("input")
            .attr("type", "checkbox")
            .attr("checked", true)
            .attr("id","box2")
            .attr("onClick", "boxclick(this,mapbox_data)")
          d3.select("#check_box")
            .append('label')
            .text("Recovered Cases")

          d3.select("#check_box")
            .append("svg")
            .attr("height",20)
            .attr("width",20)
            .append("circle")
            .attr("cx",10)
            .attr("cy",12)
            .attr("r",8)
            .style("fill","#4d0000")
            .style("opacity", 1.0)
          d3.select("#check_box")
            .append("input")
            .attr("type", "checkbox")
            .attr("checked", true)
            .attr("id","box3")
            .attr("onClick", "boxclick(this,mapbox_data)")
          d3.select("#check_box")
            .append('label')
            .text("Death Cases")
          })
        })
      })
    // set_legend()
  </script>
</body>
</html>


